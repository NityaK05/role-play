<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Role-Play Simulator — Simulation</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0D0B14; color: white; height: 100vh; overflow: hidden;
    }
    .container { display: flex; height: 100vh; }
    .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: #1B1625;
      padding: 15px 16px; /* Made nav bar taller */
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1;
      font-size: 16px;
    }
    .header-left { display: flex; align-items: center; gap: 20px; }
    .logo { display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: 600; }
    .logo-icon {
      width: 24px; height: 24px; background: #7c3aed; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
    }
    .nav-tabs { display: flex; gap: 5px; background: #1B1625; border-radius: 8px; padding: 4px; }
    .nav-tab {
      padding: 8px 16px; border-radius: 6px; background: none; border: none;
      color: white; font-size: 14px; cursor: pointer; transition: all 0.2s;
    }
    .nav-tab.active { background: #7c3aed; }
    .header-right { display: flex; align-items: center; gap: 20px; }
    .session-info { font-size: 14px; color: #a0a0a0; }
    .status-indicator {
      display: flex; align-items: center; gap: 8px;
      background: rgba(34,197,94,0.2); color: #22c55e;
      padding: 6px 12px; border-radius: 20px; font-size: 12px;
    }
    .status-dot { width: 6px; height: 6px; background: #22c55e; border-radius: 50%; }
    .content {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 40px;
    }
    .avatar {
      width: 120px; height: 120px;
      background: linear-gradient(135deg,#7c3aed,#a855f7);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      margin-bottom: 30px; position: relative;
    }
    .avatar::before {
      content: ''; position: absolute; inset: -3px;
      background: linear-gradient(135deg,#7c3aed,#a855f7);
      border-radius: 50%; z-index: -1; opacity: 0.3; filter: blur(10px);
    }
    .robot-icon { font-size: 48px; }
    .title {
      font-size: 32px; font-weight: 600; margin-bottom: 16px;
      background: linear-gradient(135deg,#fff,#a855f7);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .description {
      font-size: 16px; color: #a0a0a0; text-align: center;
      max-width: 500px; line-height: 1.6; margin-bottom: 40px;
      min-height: 80px; display: flex; align-items: center; justify-content: center;
    }
    .countdown-number {
      font-size: 48px; font-weight: 700; color: #7c3aed;
      text-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
      animation: countdownPulse 1s ease-in-out;
    }
    @keyframes countdownPulse {
      0% { transform: scale(1.2); opacity: 0; }
      50% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0.8); opacity: 0.8; }
    }
    .countdown-text {
      font-size: 18px; color: #a855f7; font-weight: 600;
      animation: fadeInUp 0.5s ease-out;
    }
    .back-btn {
      position: absolute;
      left: 0;
    }

    .back-btn:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .controls { display: flex; gap: 16px; align-items: center; }
    .control-btn {
      width: 56px; height: 56px; border-radius: 50%; border: none;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 20px; transition: all 0.2s; position: relative;
    }

    .control-btn:hover { transform: scale(1.05); }
    .start-pause-btn {
      background: linear-gradient(135deg,#6C5CE7, #A29BFE); color: white;
      box-shadow: 0 4px 20px rgba(108, 92, 231, 0.4); transition: all 0.3s ease;
    }
    .start-pause-btn.active {
      background: #2D1B4E;
      box-shadow: 0 4px 20px rgba(19, 15, 32, 0.4);
    }
    .end-btn {
      background: linear-gradient(135deg,#6C5CE7, #A29BFE); color: white;
      box-shadow: 0 4px 20px rgba(108, 92, 231, 0.4);
    }
    .retry-btn {
      background: linear-gradient(135deg,#6C5CE7, #A29BFE); color: white;
      box-shadow: 0 4px 20px rgba(108, 92, 231, 0.4);
    }
    .sidebar {
      width: 350px; background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px); border-left: 1px solid rgba(255,255,255,0.1);
      padding: 30px; overflow-y: auto;
    }
    .sidebar-section { margin-bottom: 30px; }
    .sidebar-title {
      font-size: 14px; font-weight: 600; color: #a0a0a0;
      text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 20px;
    }
    .analytics-grid { display: grid; gap: 16px; }
    .metric {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .metric:last-child { border-bottom: none; }
    .metric-label { font-size: 14px; color: #e5e5e5; }
    .metric-value { font-size: 14px; font-weight: 600; color: white; }
    .goals-list { display: flex; flex-direction: column; gap: 16px; }
    .goal-card {
      background: rgba(124,58,237,0.2); border: 1px solid rgba(124,58,237,0.3);
      border-radius: 12px; padding: 16px;
    }
    .goal-priority {
      display: inline-block; background: #7c3aed; color: white;
      font-size: 10px; font-weight: 600; padding: 4px 8px;
      border-radius: 12px; text-transform: uppercase; margin-bottom: 8px;
    }
    .goal-title { font-size: 14px; font-weight: 600; color: white; margin-bottom: 6px; }
    .goal-description { font-size: 12px; color: #a0a0a0; line-height: 1.4; }
    .chat-button {
      position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
      background: linear-gradient(135deg,#7c3aed,#a855f7); border: none;
      border-radius: 50%; color: white; font-size: 24px; cursor: pointer;
      box-shadow: 0 6px 25px rgba(124,58,237,0.4); transition: all 0.2s; z-index:1000;
    }
    .chat-button:hover { transform: scale(1.05); box-shadow: 0 8px 30px rgba(124,58,237,0.5); }
    .transcript-modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
      display: none; align-items: center; justify-content: center; z-index: 2000;
    }
    .transcript-modal.active { display: flex; }
    .transcript-content {
      background: linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
      border: 1px solid rgba(255,255,255,0.2); border-radius: 16px;
      width: 90%; max-width: 700px; height: 80%; display: flex; flex-direction: column;
    }
    .transcript-header {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .transcript-title {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: white;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .close-btn {
      background: none; border: none; color: #a0a0a0; font-size: 24px;
      cursor: pointer; width: 32px; height: 32px; display: flex;
      align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s;
    }
    .close-btn:hover { background: rgba(255,255,255,0.1); color: white; }
    .transcript-body { flex: 1; padding: 24px; overflow-y: auto; }
    .transcript-message { margin-bottom: 16px; padding: 12px 16px; border-radius: 12px; }
    .transcript-message.user {
      background: rgba(124,58,237,0.2); border: 1px solid rgba(124,58,237,0.3); margin-left: 40px;
    }
    .transcript-message.assistant {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); margin-right: 40px;
    }
    .message-header { font-size: 12px; font-weight: 600; color: #a0a0a0; margin-bottom: 6px; }
    .message-content { font-size: 14px; color: white; line-height: 1.5; }
    .empty-transcript {
      text-align: center; color: #a0a0a0; padding: 40px; font-size: 14px;
    }
    .completion-modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
      display: none; align-items: center; justify-content: center; z-index:3000;
    }
    .completion-modal.active { display: flex; }
    .completion-content {
      background: linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);
      border: 1px solid rgba(255,255,255,0.2); border-radius: 20px;
      padding: 40px; text-align: center; max-width: 500px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .completion-title {
      font-size: 24px; font-weight: 600; margin-bottom: 16px;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .completion-message {
      font-size: 16px; color: #a0a0a0; line-height: 1.6; margin-bottom: 30px;
    }
    .completion-actions { display: flex; gap: 16px; justify-content: center; }
    .completion-btn {
      padding: 12px 24px; border-radius: 12px; border: none;
      font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
      display: flex; align-items: center; gap: 8px;
    }
    .completion-btn:hover { transform: translateY(-2px); }
    .view-transcript-btn {
      background: linear-gradient(135deg,#7c3aed,#6d28d9); color: white;
      box-shadow: 0 4px 20px rgba(124,58,237,0.3);
    }
    .new-session-btn {
      background: linear-gradient(135deg,#22c55e,#16a34a); color: white;
      box-shadow: 0 4px 20px rgba(34,197,94,0.3);
    }
    .session-stats {
      background: rgba(255,255,255,0.05); border-radius: 12px;
      padding: 20px; margin: 20px 0; display: grid;
      grid-template-columns: 1fr 1fr; gap: 16px;
    }
    .stat-item { text-align: center; }
    .stat-value { font-size: 20px; font-weight: 600; color: white; margin-bottom: 4px; }
    .stat-label {
      font-size: 12px; color: #a0a0a0; text-transform: uppercase; letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <header class="header">
        <div class="header-left">
          <div class="logo">
            <div class="logo-icon">🎭</div>
            Role-Play Simulator
          </div>
          <div class="nav-tabs"></div>
        </div>
        <div class="header-right">
          <div class="session-info" id="sessionInfo">Loading Session Title...</div>
        </div>
      </header>

      <div class="content">
        <div class="avatar"><div class="robot-icon">🤖</div></div>
        <h1 class="title">Ready to Practice</h1>
        <p class="description" id="description">
          I'm ready to help you practice.
        </p>
        <div class="controls">
          <button id="startPauseBtn" class="control-btn start-pause-btn" title="Start Conversation">▶</button>
          <button id="endBtn" class="control-btn end-btn" title="End Conversation">⏹</button>
          <button id="retryBtn" class="control-btn retry-btn" title="Try Again"><img src="image (1).svg" alt="Try Again" style="height: 50px; width: 50px;" ></button>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <div class="sidebar-section">
        <h3 class="sidebar-title">Session Analytics</h3>
        <div class="analytics-grid">
          <div class="metric"><span class="metric-label">Duration</span><span class="metric-value" id="duration">0:00</span></div>
          <div class="metric"><span class="metric-label">Confidence</span><span class="metric-value" id="confidence">85%</span></div>
          <div class="metric"><span class="metric-label">Clarity</span><span class="metric-value" id="clarity">92%</span></div>
          <div class="metric"><span class="metric-label">Tone</span><span class="metric-value" id="tone">Professional</span></div>
          <div class="metric"><span class="metric-label">Pace</span><span class="metric-value" id="pace">Moderate</span></div>
        </div>
      </div>
      <div class="sidebar-section">
        <h3 class="sidebar-title">Key Goals</h3>
        <div class="goals-list">
          <div class="goal-card"><div class="goal-priority">High</div><div class="goal-title">Present salary research</div><div class="goal-description">Support your request with market data and industry benchmarks.</div></div>
          <div class="goal-card"><div class="goal-priority">Medium</div><div class="goal-title">Highlight achievements</div><div class="goal-description">Mention specific contributions and measurable results.</div></div>
          <div class="goal-card"><div class="goal-priority">Medium</div><div class="goal-title">Ask open questions</div><div class="goal-description">Understand their perspective and constraints.</div></div>
          <div class="goal-card"><div class="goal-priority">Low</div><div class="goal-title">Discuss next steps</div><div class="goal-description">Set clear timeline and follow-up actions.</div></div>
        </div>
      </div>
    </div>
  </div>

  <button id="chatBtn" class="chat-button" title="View Transcript">💬</button>

  <!-- Transcript Modal -->
  <div class="transcript-modal" id="transcriptModal">
    <div class="transcript-content">
      <div class="transcript-header">
        <button class="close-btn" onclick="handleTranscriptBack()">←</button>
        <h2 class="transcript-title">Conversation Transcript</h2>
      </div>
      <div class="transcript-body" id="transcriptBody">
        <div class="empty-transcript">No conversation started yet. Click the start button to begin practicing.</div>
      </div>
    </div>
  </div>

  <!-- Completion Modal -->
  <div class="completion-modal" id="completionModal">
    <div class="completion-content">
      <h2 class="completion-title">🎉 Session Complete!</h2>
      <p class="completion-message">
        Great job practicing! Your conversation has been saved and you can review the transcript to see how you performed.
      </p>
      <div class="session-stats">
        <div class="stat-item"><div class="stat-value" id="finalDuration">0:00</div><div class="stat-label">Duration</div></div>
        <div class="stat-item"><div class="stat-value" id="finalConfidence">85%</div><div class="stat-label">Confidence</div></div>
        <div class="stat-item"><div class="stat-value" id="finalClarity">92%</div><div class="stat-label">Clarity</div></div>
        <div class="stat-item"><div class="stat-value" id="finalMessages">0</div><div class="stat-label">Messages</div></div>
      </div>
      <div class="completion-actions">
        <button class="completion-btn view-transcript-btn" onclick="viewFinalTranscript()">📄 View Transcript</button>
        <button class="completion-btn new-session-btn" onclick="startNewSession()">✨ New Session</button>
      </div>
    </div>
  </div>

  <script>
    let conversationStarted = false;
    let conversationPaused  = false;
    let sessionStartTime    = null;  // When session first started
    let resumeTime          = null;  // When session was last resumed
    let accumulatedTime     = 0;     // Total time accumulated before pause
    let durationInterval    = null;
    let transcript          = [];
    let transcriptOpenedFromCompletion = false; // Track how transcript was opened

    const startPauseBtn = document.getElementById('startPauseBtn');
    const endBtn        = document.getElementById('endBtn');
    const retryBtn      = document.getElementById('retryBtn');
    const chatBtn       = document.getElementById('chatBtn');
    const description   = document.getElementById('description');

    const originalDescription = "I'm ready to help you practice your ______. I'll play the role of _____ and provide realistic responses based on your scenario setup.";

    document.addEventListener('DOMContentLoaded', () => {
      const title = 'sessionTitle' in localStorage ? localStorage.getItem('sessionTitle') : 'Practice Session';
      document.getElementById('sessionInfo').textContent = title;
      updateStatus('Ready', '#22c55e');
    });

    // Countdown helper - now shows countdown in main description area
    function runCountdown(onComplete, label) {
      let count = 3;
      
      function showCountdown() {
        if (count > 0) {
          description.innerHTML = `<div class="countdown-number">${count}</div>`;
          count--;
          setTimeout(showCountdown, 1000);
        } else {
          description.innerHTML = `<div class="countdown-text">${label}</div>`;
          setTimeout(() => {
            onComplete();
          }, 500);
        }
      }
      
      showCountdown();
    }

    function resetDescription() {
      description.textContent = originalDescription;
    }

    function startSession() {
      conversationStarted = true;
      conversationPaused  = false;
      sessionStartTime    = Date.now();
      resumeTime          = Date.now();
      accumulatedTime     = 0;
      durationInterval    = setInterval(updateDuration, 1000);
      startPauseBtn.innerHTML = '⏸';
      startPauseBtn.classList.add('active');
      updateStatus('Active', '#22c55e');
      
      // Show session active message
      description.textContent = "Session is now active. The manager is ready to discuss.";
    }

    function pauseSession() {
      conversationPaused = true;
      // Add current session time to accumulated time
      accumulatedTime += Date.now() - resumeTime;
      clearInterval(durationInterval);
      startPauseBtn.innerHTML = '▶';
      startPauseBtn.classList.remove('active');
      updateStatus('Paused', '#f59e0b');
      addTranscriptMessage('assistant', 'Session paused.');
      description.textContent = "Session paused. Click the play button to resume your practice.";
    }

    function resumeSession() {
      conversationPaused = false;
      resumeTime = Date.now(); // Reset resume time
      startPauseBtn.innerHTML = '⏸';
      startPauseBtn.classList.add('active');
      updateStatus('Active', '#22c55e');
      durationInterval = setInterval(updateDuration, 1000);
      description.textContent = "Session resumed. Continue with your practice.";
    }

    // Wire up start/pause/resume
    startPauseBtn.addEventListener('click', () => {
      if (!conversationStarted) {
        runCountdown(startSession, 'Starting session…');
      } else if (!conversationPaused) {
        pauseSession();
      } else {
        runCountdown(resumeSession, 'Resuming session…');
      }
    });

    endBtn.addEventListener('click', () => {
      if (!conversationStarted) return;
      // Add final time if session is active
      if (!conversationPaused) {
        accumulatedTime += Date.now() - resumeTime;
      }
      clearInterval(durationInterval);
      addTranscriptMessage('assistant', 'Thank you for the practice session. Good luck with your real negotiation!');
      description.textContent = "Session ended. Great job practicing your negotiation skills!";
      showCompletionModal();
    });

    retryBtn.addEventListener('click', () => {
      clearInterval(durationInterval);
      conversationStarted = false;
      conversationPaused  = false;
      sessionStartTime    = null;
      resumeTime          = null;
      accumulatedTime     = 0;
      transcript = [];
      transcriptOpenedFromCompletion = false;
      document.getElementById('duration').textContent = '0:00';
      updateStatus('Ready', '#22c55e');
      updateTranscriptDisplay();
      startPauseBtn.innerHTML = '▶';
      startPauseBtn.classList.remove('active');
      resetDescription(); // Reset to original description
    });

    chatBtn.addEventListener('click', () => {
      transcriptOpenedFromCompletion = false; // Opened from chat button
      openTranscript();
    });

    function updateDuration() {
      if (!conversationPaused && resumeTime) {
        // Current elapsed time = accumulated time + time since last resume
        const totalElapsed = Math.floor((accumulatedTime + (Date.now() - resumeTime)) / 1000);
        const m = Math.floor(totalElapsed / 60);
        const s = totalElapsed % 60;
        document.getElementById('duration').textContent = `${m}:${s.toString().padStart(2,'0')}`;
      }
    }

    function updateStatus(status, color) {
      let ind = document.querySelector('.status-indicator');
      if (!ind) {
        ind = document.createElement('div');
        ind.className = 'status-indicator';
        ind.innerHTML = '<div class="status-dot"></div><span></span>';
        document.querySelector('.header-right').append(ind);
      }
      ind.style.background = `rgba(${hexToRgb(color)},0.2)`;
      ind.style.color = color;
      ind.querySelector('.status-dot').style.background = color;
      ind.querySelector('span').textContent = status;
    }

    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1,3),16),
            g = parseInt(hex.slice(3,5),16),
            b = parseInt(hex.slice(5,7),16);
      return `${r},${g},${b}`;
    }

    function addTranscriptMessage(sender, message) {
      transcript.push({ sender, message, timestamp: new Date().toLocaleTimeString() });
      updateTranscriptDisplay();
    }

    function updateTranscriptDisplay() {
      const body = document.getElementById('transcriptBody');
      if (transcript.length === 0) {
        body.innerHTML = '<div class="empty-transcript">No conversation started yet. Click the start button to begin practicing.</div>';
        return;
      }
      body.innerHTML = transcript.map(m => `
        <div class="transcript-message ${m.sender}">
          <div class="message-header">${m.sender==='user'?'You':'Manager'} – ${m.timestamp}</div>
          <div class="message-content">${m.message}</div>
        </div>
      `).join('');
      body.scrollTop = body.scrollHeight;
    }

    function openTranscript() {
      document.getElementById('transcriptModal').classList.add('active');
    }

    function handleTranscriptBack() {
      document.getElementById('transcriptModal').classList.remove('active');
      
      // If transcript was opened from completion modal, return to completion modal
      if (transcriptOpenedFromCompletion) {
        document.getElementById('completionModal').classList.add('active');
        transcriptOpenedFromCompletion = false; // Reset flag
      }
    }

    function showCompletionModal() {
      document.getElementById('finalDuration').textContent = document.getElementById('duration').textContent;
      document.getElementById('finalConfidence').textContent = document.getElementById('confidence').textContent;
      document.getElementById('finalClarity').textContent = document.getElementById('clarity').textContent;
      document.getElementById('finalMessages').textContent = transcript.length;
      document.getElementById('completionModal').classList.add('active');
    }

    function viewFinalTranscript() {
      transcriptOpenedFromCompletion = true; // Mark that transcript was opened from completion
      document.getElementById('completionModal').classList.remove('active');
      openTranscript();
    }

    function startNewSession() {
      document.getElementById('completionModal').classList.remove('active');
      if (confirm('Start a new practice session? This will reset your current progress and transcript.')) {
        retryBtn.click();
      } else {
        document.getElementById('completionModal').classList.add('active');
      }
    }
  </script>
</body>
</html>